# Проблемы и риски при увеличении нагрузки

- **Синхронное взаимодействие:**  
  Компоненты системы обмениваются данными синхронно, что означает, что при увеличении нагрузки на один из них, связанные компоненты также испытывают возрастание нагрузки. Это повышает риск отказа всей системы, если один из элементов выйдет из строя.

- **Блокировки процессов:**  
  Синхронный обмен информацией может приводить к блокировкам, когда процессы вынуждены ждать ответа от других компонентов.

- **Горизонтальное масштабирование:**  
  В задаче №1 была запланирована горизонтальная масштабируемость для обработки увеличенной нагрузки. Однако, при сохранении синхронного взаимодействия, масштабировать придётся сразу все компоненты пропорционально увеличению нагрузки, а не только отдельные.

- **Увеличение времени обработки:**  
  Суммарное время взаимодействий между компонентами ведёт к росту времени обработки запросов.

# Предлагаемое решение

## Переход на EDA-архитектуру

Перевод системы на событийно-ориентированную архитектуру (EDA) позволит отказаться от прямых синхронных вызовов между сервисами `ins-product-aggregator`, `ins-comp-settlement` и приложением `core-app`. Это снизит время отклика, так как уменьшится количество сетевых обращений между компонентами.

## Репликация данных

Организация репликации данных между базами `core-db` и `ins-comp-settlement-db` обеспечит возможность обработки запроса микросервисом и приложением без обращения к сервису `ins-product-aggregator`. Такой подход увеличивает отказоустойчивость системы, поскольку разрыв синхронной связи между компонентами минимизирует риск полного или частичного отказа потребителей при недоступности одного из сервисов.

## Использование Apache Kafka

В качестве брокера сообщений предлагается внедрить Apache Kafka. В рамках этой схемы обмен сообщений будет организован по трём топикам:
- **Продукты**
- **Тарифы**
- **Оформленные страховки**

## Паттерн Transactional Outbox

Для обеспечения надёжной доставки сообщений будет использоваться паттерн Transactional Outbox с подходом Transaction Log Tailing:
- Приложение `core-app` сохраняет информацию об оформленных страховках в соответствующую таблицу базы данных.
- Компонент `T-outbox` считывает логи изменений этой таблицы и публикует их в топик, предназначенный для оформленных страховок.
- Сервис `ins-comp-settlement` раз в день асинхронно извлекает новые записи из топика для дальнейшей обработки.


[ссылка на решение drawio]: https://drive.google.com/file/d/1DtrvONFRwOXQTMSFj82aa3wYfTa6etmz/view?usp=sharing